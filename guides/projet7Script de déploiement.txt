1Ô∏è‚É£ Script de d√©ploiement automatique (deploy.sh)

√Ä placer √† la racine du projet (projet7/) puis rendre ex√©cutable :

chmod +x deploy.sh


Contenu du script :

#!/bin/bash

echo "üöÄ D√©ploiement en cours..."

# 1. Aller dans le dossier du projet
cd /chemin/vers/projet7 || exit
echo "üìÇ Dossier projet : OK"

# 2. Mettre √† jour le d√©p√¥t
# Utiliser la branche correcte (master ou main)
git pull origin master

# 3. Installer les d√©pendances
echo "üîß Installation / V√©rification des d√©pendances..."
npm install

# 4. (Optionnel) Build du front si n√©cessaire
# echo "üèóÔ∏è Build du projet..."
# npm run build

# 5. Red√©marrer le service avec PM2
echo "‚ôªÔ∏è Red√©marrage du serveur..."
pm2 restart wave-api || pm2 start server.js --name "wave-api"

# 6. Affichage de l‚Äô√©tat
pm2 status

echo "‚úÖ D√©ploiement termin√© avec succ√®s."


Pour lancer le d√©ploiement :

./deploy.sh

2Ô∏è‚É£ Proc√©dure de d√©ploiement ‚Äì Guide complet
Titre : Proc√©dure de D√©ploiement de l‚ÄôAPI Wave
üéØ Objectif

D√©ployer l‚Äôapplication Wave API (Node.js + Express + MongoDB) sur un serveur Windows ou Linux avec PM2, en s√©curisant les secrets.

üèóÔ∏è Pr√©-requis
Outil	Utilit√©
Node.js (‚â• 18)	Ex√©cuter le serveur
npm	Gestion des packages
MongoDB Atlas ou local	Base de donn√©es
Git	R√©cup√©ration et mise √† jour du projet
PM2	Gestion du processus Node.js
NGINX (optionnel)	Reverse proxy et HTTPS
1Ô∏è‚É£ R√©cup√©ration du projet sur le serveur
git clone https://github.com/mon-repo/projet7.git
cd projet7


V√©rifie la branche utilis√©e :

git branch
# Exemple : master

2Ô∏è‚É£ Configuration des variables d‚Äôenvironnement

Cr√©er un fichier .env √† la racine (NE PAS COMMITTER) :

MONGO_URI=mongodb+srv://user:password@cluster.mongodb.net/wave
JWT_SECRET=une_phrase_complexe
TOKEN_EXP=24h
PORT=3000


Ajouter .env au .gitignore :

.env


Cr√©er un .env.example pour documenter les variables n√©cessaires :

MONGO_URI=
JWT_SECRET=
TOKEN_EXP=
PORT=3000

3Ô∏è‚É£ Installation des d√©pendances
npm install

4Ô∏è‚É£ Installation et configuration de PM2

Installer PM2 globalement :

npm install -g pm2


Lancer l‚Äôapplication la premi√®re fois :

pm2 start server.js --name "wave-api"


Sauvegarder la configuration pour red√©marrage automatique :

pm2 save
pm2 startup

5Ô∏è‚É£ (Optionnel) Configuration NGINX en reverse proxy

Cr√©er un fichier /etc/nginx/sites-available/wave :

server {
  listen 80;
  server_name mon-domaine.fr;

  location / {
    proxy_pass http://localhost:3000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
  }
}


Activer la configuration :

ln -s /etc/nginx/sites-available/wave /etc/nginx/sites-enabled/
systemctl reload nginx

6Ô∏è‚É£ D√©ploiement apr√®s mise √† jour du code
./deploy.sh


Si c‚Äôest la premi√®re fois ou si PM2 n‚Äôest pas lanc√© :

pm2 start server.js --name "wave-api"

7Ô∏è‚É£ V√©rification du bon fonctionnement

V√©rifier les logs PM2 :

pm2 logs wave-api


V√©rifier l‚Äô√©tat du serveur :

pm2 status


Tester l‚ÄôAPI :

curl http://localhost:3000/api/books

‚úÖ R√©sultat final

D√©ploiement automatis√© avec deploy.sh

Serveur s√©curis√© et stable avec PM2

Base MongoDB fonctionnelle

Reverse proxy op√©rationnel (facultatif)